劉永福者，廣西上恩州人。咸豐間廣西亂，永福率三百人出鎮南關。時粵人何均昌據保勝，永福逐而去之，遂據保勝，所部旗皆黑色，號「黑旗軍」。永福既立功，越南授三省提督職，時時自備餉械剿匪，而黃佐炎皆匿不上聞，越臣亦多忌之，永福積怨於佐炎。佐炎為越南駙馬，以大學士督師，督撫均受節制。馮子材為廣西提督時，佐炎以事來見，子材坐將臺，令以三跪九叩見，佐炎銜之次骨。越難已深，國王阮福時憤極決戰，責令佐炎督永福出師，六調不至。法軍忌永福，故越王始終倚任之。

先是，劉長佑命藩司唐炯率舊部屯保勝，曾國荃至粵，命提督黃得勝統兵防欽州，提督吳全美率兵輪八艘防北海，廣西防軍提督黃桂蘭、道員趙沃相繼出關，所謂三省合規北圻也。時法人要中國會議越事，諭滇、粵籌畫備議。法使寶海至天津，命北洋大臣會商越南通商分界事宜。吏部主事唐景崧自請赴越南招撫劉永福，帝命發雲南岑毓英差遣。九年正月，景崧乃假道越南入滇，先至粵謁曾國荃，韙其議，資之入越。見永福，為陳三策，言：「越為法逼，亡在旦夕，誠因保勝傳檄而定諸省，請命中國，假以名義，事成則王，此上策也；次則提全師擊河內，驅法人，中國必助之餉，此中策也；如坐守保勝，事敗而投中國，此下策也。」永福曰：「微力不足當上策，中策勉為之。」

三月，法軍破南定。帝諭廣西布政使徐延旭出關會商，黃桂蘭、趙沃籌防。李鴻章丁憂，奪情回北洋大臣任，鴻章懇辭。至是，命鴻章赴廣東督辦越南事宜，粵、滇、桂三省防軍均歸節制。鴻章奏擬赴上海統籌全局。法使寶海在天津議約久不協，奉調回國，以參贊謝滿祿代理。劉永福與法人戰於河內之紙橋，大破法軍，陣斬法將李成利，越王封永福一等男。徐延旭奏留唐景崧防營效用，並陳永福戰績。帝促李鴻章回北洋大臣任，並詢法使脫利古至滬狀，令鴻章定期會議。脫利古詢鴻章：「是否助越？」鴻章仍以邊界、剿匪為辭，而法兵已轉攻順化國都，迫其議約。鴻章與法新使德理議不就，法兵聲言犯粵，廣東戒嚴。總署致法使書，言：「越南久列藩封，歷經中國用兵剿匪，力為保護。今法人侵陵無已，豈能蔑視？倘竟侵我軍駐扎之地，惟有決戰，不能坐視。」帝諭徐延旭飭劉永福相機規復河內，法軍如犯北寧，即令接戰。命滇督增兵防邊，唐蜅迅赴前敵備戰，並濟永福軍餉。旋命岑毓英出關督師。

法兵破越之山西省，粵勢愈急，以彭玉麟為欽差大臣督粵師。彭玉麟奏：「法人逼越南立約，欲中國不預紅河南界之地，及許在雲南蒙自縣通商，顯系圖我滇疆，冀專五金之利。不特滇、粵邊境不能解嚴，即廣東、天津，亦須嚴備。」時越南王阮福時薨，無子，以堂弟嗣。法人乘越新喪，以兵輪攻順化海口，入據都城。越南嗣君在位一月，輔政阮說啟太妃廢之，改立阮福升。至是乞降於法，立約二十七條，其第一條即言中國不得干預越南事，此外政權、利權均歸法人，逼王諭諸將退兵，重在逐劉永福也。

滇撫唐炯屢促永福退兵，永福欲退駐保勝，黑旗將士皆憤怒。副將黃守忠言：「公可退保勝，請以全軍相付，守山西。有功，公居之，罪歸末將。」永福遂不復言退。徐延旭奏言：「越人倉卒議和，有謂因故君未葬權顧目前者，有謂因廢立之嫌，廷臣植黨構禍者。迭接越臣黃佐炎等鈔寄和約，越誠無以保社稷，中國又何以固藩籬？越臣輒以俟葬故君即行翻案為詞，請無撤兵。劉永福仍駐守山西，嗣王阮福升嗣位，具稟告哀，並懇準其遣使詣闕乞封。越國人心渙散，能否自立，尚未可知。」並將法越和約二十七款及越臣黃佐炎來稟錄送軍機處。

兩江總督左宗棠請飭前藩司王德榜募勇赴桂邊扼扎。十一月，法人破興安省，拘巡撫、布政、按察至河內槍斃之。進攻山西，破之，劉團潰，永福退守興化城。十二月，嗣王阮福升暴卒，或云畏法逼自裁，國人立前王阮福時第三繼子為王，輔政阮說之子也。徐延旭奏報山西失守，北寧斷無他虞，帝責其誇張。十年，唐景崧在保勝上樞府書，言：「滇、桂兩軍偶通文報，為日甚遲，聲勢實不易連絡。越南半載之內，三易嗣君，臣庶皇皇，類於無主。欲培其根本以靖亂源，莫如遣師直入順化，扶翼其君，以定人心而清匪黨，敵焰庶幾稍戢，軍事亦易於措手。若不為藩服計，北圻沿邊各省，我不妨直取，以免坐失外人。否則首鼠兩端，未有不歸於敗者也。」

劉永福謁岑毓英於家喻關，毓英極優禮之，編其軍為十二營。法軍將攻北寧，毓英遣景崧率永福全軍赴援。桂軍黃桂蘭、趙沃方守北寧，山西之圍，桂蘭等坐視不救，永福憾之深，景崧力解之，乃赴援。景崧勸桂蘭離城擇隘而守，桂蘭不從。二月，法兵攻扶良，總兵陳得貴乞援，北寧師至，扶良已潰，法兵進逼北寧，黃桂蘭、趙沃敗奔太原，劉永福亦坐視不救。徐延旭老病，與趙沃有舊，偏信之。趙沃庸懦，其將黨敏宣奸，欺蔽延旭。敵犯北寧，敏宣先遁。陳得貴為馮子材舊部；驍勇善戰，子材曾劾延旭，延旭怨之，並怨得貴。及北寧陷，乃奏戮之，敏宣亦正法。延旭調度失宜，帝命革職留任。三月，命湖南巡撫潘鼎新辦廣西關外軍務，接統徐延旭軍，黃桂蘭懼罪仰藥死。帝諭：「徐延旭株守諒山，僅令提督黃桂蘭、道員趙沃駐守北寧，遇敵先潰，殊堪痛恨！徐延旭革職拿問，黃桂蘭、趙沃潰敗情形，交潘鼎新查辦。」以王德榜署廣西提督，德榜辭不拜。唐炯革職拿問，以張凱嵩為雲南巡撫。北寧敗後，徐延旭以唐景崧護軍收集敗殘，申明約束。時唐仁廉署廣西提督。法軍由北寧進據興化，別以兵艦八艘駛入中國海，窺廈門及上海吳淞口，沿海戒嚴，於是中、法和議起。

四月，李鴻章與法總兵福祿諾在天津商訂條款，諭滇、桂防軍候旨進止。鴻章旋以和約五款入告，大略言：「中國南界毗連北圻，法國任保護，不虞侵占。中國應許於毗連北圻之邊界，法、越貨物聽其運銷，將來法與越改約，決不插入傷中國體面之語。」朝旨報可，予鴻章全權畫押。既而法公使以簡明條約法文與漢文不符相詰，帝責鴻章辦理含混，輿論均集矢鴻章，指為「通夷」。法使既藉端廢約，帝令關外整軍嚴防，若彼竟求犯，即與交綏。命岑毓英招劉永福率所部來歸。潘鼎新奏：「法兵分路圖犯穀松、屯梅二處，桂軍械缺糧乏，恐不可恃。」帝以其飾卸，責之。法兵欲巡視諒山，抵觀音橋，桂軍止之，令勿入。法將語無狀，遂互擊，勝之。奏入，諭進規北寧，責法使先行開砲，應認償。令告法外部止法兵，並諭我軍：「如彼不來犯，不宜前進。」法使續請和議，帝諭桂軍回諒山，滇軍回保勝，不得輕開釁。

法將孤拔欲以兵艦擾海疆，法使巴德諾逗留上海，不肯赴津，乃改派曾國荃全權大臣，陳寶琛會辦，邵友濂、劉麟祥隨同辦理。諭言：「兵費、恤款萬不能允。越南須照舊封貢。劉永福一軍，如彼提及，須由我措置。分界應於關外空地作為甌脫。雲南通商應在保勝，不得逾值百抽五。」六月，法將孤拔以兵監八艘窺閩海，欲踞地為質，挾中國議約，何璟、張佩綸以聞。法艦攻臺灣之基隆砲臺，臺撫劉銘傳拒守。曾國荃、陳寶琛與法使議約於上海，國荃許給撫血⼙費五十萬，奉旨申斥。約議久不就，乃一意主戰。諭岑毓英令劉永福先行進兵，規復北圻，岑毓英、潘鼎新關內各軍陸續進發。以法人失和，不告各國。

七月，法公使謝滿祿下旗出京，帝乃宣諭曰：「越南為我封貢之國，二百餘年，載在史冊，中、外咸知。法人先據南圻各省，旋又進據河內，戮其人民，利其土地，奪其賦稅。越南闇懦，私與立約，並未奏聞，挽回無及。越亦有罪，是以姑與包涵，不加詰問。光緒八年，法使寶海在天津與李鴻章議約三條，當與總理各國事務衙門會商妥籌，法人又撤使翻覆。越之山西、北寧等省，為我軍駐扎之地，清查越匪，保護屬藩，與法國絕不相涉。本年二月間，法兵竟來撲犯，當經降旨宣示，正擬派員進取，忽據伊國總兵福祿諾先向中國議和。其時法國因埃及之事岌岌可危，中國明知其勢處迫逼，本可峻詞拒絕，而仍示以大度，許其行成，特命李鴻章與議簡明條約五款，互相畫押。諒山、保勝等軍，應照議於定約三月後調回，迭經諭飭各防軍扼扎原處，不準輕動開釁。諸軍將士，奉令維謹。乃法國不遵定約，忽於閏五月初一、初二等日，以巡邊為名，直撲諒山防營，先行開砲轟擊，我軍始與之接仗，互有殺傷。法人違背條約，無端開釁，傷我官兵，本應以干戈從事。因念訂約通好二十餘年，亦不必因此盡棄前盟，仍準各國總理事務衙門與在京法使往返照會，情喻理曉，至再至三。閏五月二十四日，復明降諭旨，照約撤兵。昭示大信，所以保全和局者，實屬仁至義盡。法人乃竟始終怙飾，橫索兵費，恣意要挾，輒於六月十五日占據臺北基隆山砲臺，經劉銘傳迎剿獲勝。本月初三日，何璟等甫接本領事照會開戰，而法兵已自馬尾先期攻擊，傷壞兵商各船。雖經官軍焚毀法船，擊壞雷艇，並陣斃法國兵官，尚未大加懲創。若再曲予含容，何以伸公論而順人心？用特揭其無理情節，布告天下。」

八月，諭岑毓英督飭劉永福及在防各營規復北圻，並諭潘鼎新飭各軍聯絡聲勢，分路並進。提督蘇元春與法軍戰於陸岸縣，敗之。十月，內閣學士周德潤奏：「官軍進取越南，宜以正兵牽制河內之師，別用奇兵由車里趨老撾，走哀牢，以暗襲順化，募用滇邊土人，必能得力。」得旨交滇督詳察籌辦。是月，蘇元春與法人戰於紙作社，陣斬法兵官四人。十一月，王德榜軍大敗於豐穀，蘇元春不往援，唐景崧與劉永福、丁槐軍攻宣光，力戰大捷，優詔褒之。十二月十九日，法兵攻穀松，王德榜以豐穀之敗怨蘇軍不救，至是亦不往援，蘇軍敗退威坡，諒山戒嚴。帝命馮子材幫辦廣西關外軍務。二十九日，法軍攻諒山，據之，潘鼎新等退駐鎮南關，龍州大震。唐景崧、劉永福、丁槐攻宣光，月餘不能下。諒山失守，岑毓英慮景崧等軍斷後援，令勿拚孤注，景崧不可。馮子材與法軍戰於文淵，互有殺傷。

十一年正月初九日，法兵攻鎮南關，轟毀關門而去，提督楊玉科戰歿。潘鼎新退駐海村，帝命戴罪立功。元春退駐幕府。王德榜自負湘中宿將，屢催援不至，鼎新劾之，落職，所部歸元春轄。法軍攻劉永福於宣光，永福軍潰。唐景崧退駐牧馬，欽、廉防急。彭玉麟請調馮子材軍防粵，朝旨令鼎新議，鼎新素不協於子材，乃命子材行。子材以關外防緊，不肯退，玉麟乃令專顧桂防。鼎新師久無功，褫職，以李秉衡護理廣西巡撫，蘇元春督辦廣西軍務。法兵既毀鎮南關，逃軍難民蔽江而下，廣西全省大震。子材至，乃力為安輯。

子材久駐粵西，素有威惠，桂、越民懷之，人心始定。乃於關內十里之關前隘，跨東西兩嶺間，築長墻三里餘，外掘深塹，為扼守計，自率所部駐之，而令王孝祺勒軍屯其後為犄角。法兵揚言某日犯關，子材逆料其必先期至，乃議先發制敵，鼎新止之，子材力爭，徑率王孝祺軍夜犯敵壘，殺敵甚多。法起諒山之眾撲鎮南關，子材誓眾曰：「法再入關，吾有何面目見粵人？必死拒之！」士氣皆憤。法攻長墻，急砲猛烈，子材勒諸統將屹立接戰，遇退後者手刃之。戰酣，子材自開壁率兩子相榮、相華直沖敵軍，諸軍以子材年七十，奮身陷敵，皆感憤，殊死戰。王孝祺、陳嘉率部將潘瀛、張春發等隨其後，王德榜軍旁至，夾擊之，斃法兵無算。鏖戰兩日，法軍子彈盡，大敗潰遁。子材率兵攻文淵，法軍棄城走。諸軍三路攻諒山，孝祺、德榜戰尤力，連戰皆捷。二月十三日，遂克諒山，法悉眾遁。子材進軍克拉木，逼攻郎甲，王孝祺進軍貴門關，盡復昔年所駐邊地。越民立忠義五大團；二萬餘人，皆建馮軍旗幟。西貢亦聞風通款。自海通以來，中國與外國戰，惟是役大捷，子材之功也。

法兵六千犯臨洮府，復分兩隊；一北趨珂嶺、安平，一南趨緬旺、猛羅。滇督岑毓英命岑毓寶、李應珍等扼北路，王文山扼南路，而自率軍當中路，皆有斬獲。法軍遂合趨臨洮府，滇軍拒戰南北路，回軍夾攻之，陣斬法將五人，法軍大潰。

時法兵艦據臺灣之澎湖。諒山既大捷，法人力介英人赫德向李鴻章議和，言法人交還基隆、澎湖，彼此撤兵，不索兵費。鴻章奏言：「澎湖既失，臺灣必不可保，當藉諒山一勝之威，與締和約，則法不至再事要求。」朝廷納其議，立命停戰。臨洮之戰，乃在停戰後電諭未達前也。鴻章遽請簽約，令諸將皆退還邊界，將士扼腕痛憤，不肯退，彭玉麟、張之洞屢電力爭。帝以津約斷難失信，嚴諭遵辦。法人要求逐劉永福於越南，張之洞乃擬令永福駐思、欽，永福堅不肯行，唐景崧危詞脅之，朝旨嚴切，乃勉歸於粵，授總兵。馮子材奉督辦廉、欽邊防之命。約既成，越南遂歸法國保護焉。
